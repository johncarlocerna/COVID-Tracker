<html>

<head>/>
    <meta charset="utf-8" />
    <title>Covid Tracker</title>
    <script src='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css' rel='stylesheet' />
</head>

<body>
    <script
        src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script>
    <link rel="stylesheet"
        href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css"
        type="text/css" />
    <div id='map' style='position: absolute; top: 0; right: 0; bottom: 0; left: 0;'></div>
    <script>
        mapboxgl.accessToken = 'pk.eyJ1Ijoiam9obmNhcmxvY2VybmEiLCJhIjoiY2tndHZ1ZTJ1MDdmZjJ0cWxjeWg1OHhodSJ9.isEZrIcngccYiPRpoIVSmQ';
        var map = new mapboxgl.Map({
            container: 'map',
            zoom: 3.77,
            center: [-94.522, 38.401],
            style: 'mapbox://styles/johncarlocerna/ckgtvw7is38l719pg210wups9', // stylesheet location
        });

        // map.on('load', function(e) {
        //     var dict = {};
        //     var sources = map.getStyle().layers;
        //     var countyLayer = map.querySourceFeatures('composite', {
        //         'sourceLayer': 'merged-c1d7lh'
        //     });
        //     var districtLayer = map.querySourceFeatures('composite', {
        //         'sourceLayer': 'tl_2019_us_cd116-2yzvgj'
        //     });
        //     countyLayer.forEach(cfunc);
        //     function cfunc(county, index) {
        //         var name = county.properties;
        //         dict[`${name.county}, ${name.state}`] = name;
        //     }
        //     districtLayer.forEach(dfunc);
        //     function dfunc(district, index) {
        //         console.log(district);
        //         var name = district.properties;
        //         dict[`${name.NAMELSAD}`] = name;
        //     }
        //     console.log(dict);
        // });


        map.on('click', 'COVID County Map', function (e) {
            //center map to clicked point
            // map.flyTo({
            //     center: e.features[0].geometry.coordinates
            // });
                console.log(e);
            var properties = e.features[0].properties;
            new mapboxgl.Popup({ closeButton: false })
                .setLngLat(e.lngLat)
                .setHTML(`${properties.county} <br /> ${properties.cases.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")} cases`) //regex to add commas to numbers
                .addTo(map);
        });

        // map.on('click', 'Congressional Boundaries', function (e) {
        //     var properties = e.features[0].properties;
        //     new mapboxgl.Popup()
        //         .setLngLat(e.lngLat)
        //         .setHTML(properties.NAMELSAD)
        //         .addTo(map);
        // });

        //some geocoding map function for right now

        function forwardGeocoder(query) {
           
        }

        map.addControl(
            new MapboxGeocoder({
                accessToken: mapboxgl.accessToken,
                localGeocoder: forwardGeocoder,
                zoom: 14,
                placeholder: 'Enter search',
                mapboxgl: mapboxgl
            })
        );

        // // Change the cursor to a pointer when the mouse is over the places layer.
        map.on('mouseenter', 'Congressional Boundaries', function () {
            map.getCanvas().style.cursor = 'pointer';
        });

        // Change it back to a pointer when it leaves.
        map.on('mouseleave', 'Congressional Boundaries', function () {
            map.getCanvas().style.cursor = '';
        });

        map.dragRotate.disable();
        map.touchZoomRotate.disableRotation();
    </script>
</body>

</html>